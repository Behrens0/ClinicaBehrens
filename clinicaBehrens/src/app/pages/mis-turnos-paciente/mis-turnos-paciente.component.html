<div class="mis-turnos-container">
  <h2>üóìÔ∏è Mis Turnos</h2>
  
  <div *ngIf="mensaje" class="mensaje-exito-turno">
    {{ mensaje }}
  </div>
  
  <input 
    type="text" 
    [(ngModel)]="filtro" 
    (input)="filtrarTurnos()" 
    placeholder="üîé Buscar por especialidad o especialista..." 
    class="filtro-input" />

  <div *ngIf="turnosFiltrados.length === 0" class="mensaje-vacio">
    <span>üôÅ No tienes turnos para mostrar.</span>
  </div>

  <table *ngIf="turnosFiltrados.length > 0" class="tabla-turnos">
    <thead>
      <tr>
        <th>Especialidad</th>
        <th>Especialista</th>
        <th>Fecha</th>
        <th>Horario</th>
        <th>Estado</th>
        <th>Acci√≥n</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let turno of turnosFiltrados">
        <td>{{ turno.especialidad }}</td>
        <td>{{ turno.especialistanombre }}</td>
        <td>{{ turno.fecha | formatoFecha:'customDiaMesAnioDia' }}</td>
        <td>{{ turno.fecha | date:'HH:mm' }}</td>
        <td>
          <span class="estado-{{ turno.estado }}">
            {{ turno.estado | estadoTurno }}
          </span>
        </td>
        <td>
          <span *ngIf="puedeCancelar(turno)">
            <button class="btn-cancelar" (click)="abrirModalCancelar(turno)">Cancelar</button>
          </span>
          <span *ngIf="puedeVerResena(turno)">
            <button class="btn-ver" (click)="abrirModalResena(turno)">Ver Rese√±a</button>
          </span>
          <span *ngIf="puedeCompletarEncuesta(turno)">
            <button class="btn-encuesta" (click)="abrirModalEncuesta(turno)">Completar Encuesta</button>
          </span>
          <span *ngIf="puedeCalificar(turno)">
            <button class="btn-calificar" (click)="abrirModalCalificar(turno)">Calificar Atenci√≥n</button>
          </span>
        </td>
      </tr>
    </tbody>
  </table>

  <!-- Modal cancelar turno -->
  <div class="modal-cancelar" *ngIf="mostrarModalCancelar">
    <div class="modal-content">
      <h3>Cancelar turno</h3>
      <p>Por favor, ingresa el motivo de la cancelaci√≥n:</p>
      <textarea [(ngModel)]="comentarioCancelacion" rows="3" placeholder="Motivo..." class="textarea-motivo"></textarea>
      <div *ngIf="errorMotivo" class="error-motivo">{{ errorMotivo }}</div>
      <div class="modal-actions">
        <button (click)="confirmarCancelacion()" class="btn-cancelar-modal">Confirmar</button>
        <button (click)="cerrarModalCancelar()" class="btn-cerrar-modal">Cerrar</button>
      </div>
    </div>
  </div>

  <!-- Modal ver rese√±a -->
  <div class="modal-cancelar" *ngIf="mostrarModalResena">
    <div class="modal-content">
      <h3>Rese√±a del turno</h3>
      <p class="resena-texto">{{ resenaAMostrar }}</p>
      <div class="modal-actions">
        <button (click)="cerrarModalResena()" class="btn-cerrar-modal">Cerrar</button>
      </div>
    </div>
  </div>

  <!-- Modal encuesta -->
  <div class="modal-cancelar" *ngIf="mostrarModalEncuesta">
    <div class="modal-content">
      <h3>Encuesta sobre la atenci√≥n</h3>
      <form (ngSubmit)="confirmarEncuesta()" autocomplete="off">
        <label for="comentarioEncuesta">Comentario para el m√©dico:</label>
        <textarea 
          id="comentarioEncuesta" 
          [(ngModel)]="comentarioEncuesta" 
          name="comentarioEncuesta" 
          rows="3" 
          placeholder="Escribe tu comentario..." 
          class="textarea-motivo" 
          required>
        </textarea>
        <div class="estrellas-encuesta">
          <label>Calificaci√≥n:</label>
          <ng-container *ngFor="let star of [1,2,3,4,5]">
            <span 
              (click)="estrellasEncuesta = star" 
              [class.selected]="estrellasEncuesta >= star" 
              class="estrella">‚òÖ</span>
          </ng-container>
        </div>
        <div *ngIf="errorEncuesta" class="error-motivo">{{ errorEncuesta }}</div>
        <div class="modal-actions">
          <button type="submit" class="btn-finalizar-modal">Enviar</button>
          <button type="button" (click)="cerrarModalEncuesta()" class="btn-cerrar-modal">Cerrar</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modal calificar atenci√≥n -->
  <div class="modal-cancelar" *ngIf="mostrarModalCalificar">
    <div class="modal-content">
      <h3>Calificar Atenci√≥n</h3>
      <form (ngSubmit)="confirmarCalificacion()" autocomplete="off">
        <label for="puntajeAtencion">Puntaje (1-5):</label>
        <select id="puntajeAtencion" [(ngModel)]="calificacionPuntaje" name="puntaje" required>
          <option *ngFor="let n of [1,2,3,4,5]" [value]="n">{{ n }} ‚≠ê</option>
        </select>
        <label for="comentarioAtencion">Comentario sobre la atenci√≥n:</label>
        <textarea 
          id="comentarioAtencion" 
          [(ngModel)]="calificacionComentario" 
          name="comentario" 
          rows="3" 
          placeholder="¬øC√≥mo fue la atenci√≥n del especialista?..." 
          class="textarea-motivo" 
          required>
        </textarea>
        <div *ngIf="errorMotivo" class="error-motivo">{{ errorMotivo }}</div>
        <div class="modal-actions">
          <button type="submit" class="btn-finalizar-modal">Enviar Calificaci√≥n</button>
          <button type="button" (click)="cerrarModalCalificar()" class="btn-cerrar-modal">Cerrar</button>
        </div>
      </form>
    </div>
  </div>
</div>
