<div class="mis-turnos-container">
  <h2>Turnos de la Cl√≠nica</h2>
  
  <div *ngIf="mensaje" class="mensaje-exito-turno">
    {{ mensaje }}
  </div>
  
  <input 
    type="text" 
    [(ngModel)]="filtro" 
    (input)="filtrarTurnos()" 
    placeholder="üîé Buscar por especialidad o especialista..." 
    class="filtro-input" />

  <div *ngIf="turnosFiltrados.length === 0" class="mensaje-vacio">
    <span>üôÅ No hay turnos para mostrar.</span>
  </div>

  <table *ngIf="turnosFiltrados.length > 0" class="tabla-turnos">
    <thead>
      <tr>
        <th>Paciente</th>
        <th>Especialista</th>
        <th>Especialidad</th>
        <th>Fecha</th>
        <th>Horario</th>
        <th>Estado</th>
        <th>Acci√≥n</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let turno of turnosFiltrados">
        <td>{{ turno.pacientenombre || '' }}</td>
        <td>{{ turno.especialistanombre || '' }}</td>
        <td>{{ turno.especialidad }}</td>
        <td>{{ turno.fecha | formatoFecha:'customDiaMesAnioDia' }}</td>
        <td>{{ turno.fecha | date:'HH:mm' }}</td>
        <td>
          <span class="estado-{{ turno.estado }}">
            {{ turno.estado | estadoTurno }}
          </span>
        </td>
        <td>
          <!-- ADMIN: Solo puede cancelar turnos y ver motivos -->
          <span *ngIf="puedeCancelar(turno)">
            <button class="btn-cancelar" (click)="abrirModalCancelar(turno)">Cancelar</button>
          </span>
          <span *ngIf="turno.estado === 'cancelado' && turno.comentariopaciente">
            <button class="btn-ver" (click)="abrirModalMotivo(turno)">Ver Motivo</button>
          </span>
          <span *ngIf="turno.estado === 'rechazado' && turno.comentarioespecialista">
            <button class="btn-ver" (click)="abrirModalMotivo(turno)">Ver Motivo</button>
          </span>
        </td>
      </tr>
    </tbody>
  </table>

  <!-- Modal cancelar turno -->
  <div class="modal-cancelar" *ngIf="mostrarModalCancelar">
    <div class="modal-content">
      <h3>Cancelar turno</h3>
      <p>Por favor, ingresa el motivo de la cancelaci√≥n:</p>
      <textarea [(ngModel)]="motivoOperacion" rows="3" placeholder="Motivo..." class="textarea-motivo"></textarea>
      <div *ngIf="errorMotivo" class="error-motivo">{{ errorMotivo }}</div>
      <div class="modal-actions">
        <button (click)="confirmarCancelacion()" class="btn-cancelar-modal">Confirmar</button>
        <button (click)="cerrarModalCancelar()" class="btn-cerrar-modal">Cerrar</button>
      </div>
    </div>
  </div>

  <!-- Modal ver motivo -->
  <div class="modal-cancelar" *ngIf="mostrarModalMotivo">
    <div class="modal-content">
      <h3>Motivo de {{ turnoAOperar?.estado | titlecase }}</h3>
      <p class="resena-texto">{{ motivoAMostrar }}</p>
      <div class="modal-actions">
        <button (click)="cerrarModalMotivo()" class="btn-cerrar-modal">Cerrar</button>
      </div>
    </div>
  </div>
</div>
